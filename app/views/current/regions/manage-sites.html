<!-- Use this page as the index for your project -->

{% block head %}
<!-- Include the accessible-autocomplete CSS from CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/accessible-autocomplete@2.0.4/dist/accessible-autocomplete.min.css">
{% endblock %}
<!-- ADDING CUSTOM CSS - Add your custom CSS or Sass in /app/assets/sass/main.scss -->

<!-- Extends the layout from /views/layout.html -->
{% extends 'current/regions/layout-top-nav-regions.html' %}
<!--
  In /views/layout.html you can:
    - change the header and footer
    - add custom CSS and JavaScript
-->

<!-- Set the page title -->
{% block pageTitle %}
Manage site
{% endblock %}

<!-- For adding a breadcrumb -->
<!-- Code examples can be found at https://service-manual.nhs.uk/design-system/components/breadcrumbs -->
{% block beforeContent %}

{{ backLink({
  href: "javascript:history.back()",
  text: "Back"
}) }}

{% endblock %}

<!-- For adding a back link -->
<!-- Code examples can be found at https://service-manual.nhs.uk/design-system/components/back-link -->
{% block outerContent %}
{% endblock %}

<!-- For adding page content -->
<!-- Page layout code can be found at https://service-manual.nhs.uk/design-system/styles/layout -->
{% block content %}
<div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">



      <div class="nhsuk-page-header-actions">
        <div class="nhsuk-page-header-actions__title">
          <h1 class="nhsuk-heading-l">Add and manage sites</h1>
        </div>
      
        <div class="nhsuk-page-header-actions__actions">
          <div class="nhsuk-button-group nhsuk-button-group--inline">
      
            <form method="post" action="single-site">
              <button class="nhsuk-button" data-module="nhsuk-button" type="submit">
                Add a site
              </button>
              </form>
      
      
          </div>
        </div>
      
      </div>

      <!-- SEARCH -->

      <div class="app-filters nhsuk-u-margin-top-5">
        <form method="post" action="" novalidate="">
          <div class="nhsuk-form-group nhsuk-u-margin-bottom-0">
            <label class="nhsuk-label" for="q">
              Search active sites by name, ICB or ODS code
            </label>
            <input class="nhsuk-input nhsuk-input--width-20" id="q" name="q" type="search" value="">
            
            <button class="nhsuk-button nhsuk-button--secondary nhsuk-u-margin-left-2 app-button--small nhsuk-u-margin-bottom-0" 
                    data-module="nhsuk-button" 
                    type="submit">
              Search
            </button>
          </div>
        </form>
      </div>


      <!-- END SEARCH -->

    
      <table class="nhsuk-table">
        <caption class="nhsuk-table__caption">Listing all sites in your region</caption>
        <thead class="nhsuk-table__head">
          <tr>
            <th scope="col" class="nhsuk-table__header">Name</th>
            <th scope="col" class="nhsuk-table__header">ICB</th>
            <th scope="col" class="nhsuk-table__header">ODS</th>
            <th scope="col" class="nhsuk-table__header">Contact</th>
            <th scope="col" class="nhsuk-table__header"><span aria-hidden="true" class="nhsuk-u-visually-hidden">Action</span></th>
          </tr>
        </thead>
        <tbody class="nhsuk-table__body">
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Lloyds Pharmacy</td>
            <td class="nhsuk-table__cell">North East and North Cumbria ICB</td>
            <td class="nhsuk-table__cell">5PLE9</td>
            <td class="nhsuk-table__cell">glenn.tidings@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="edit-site">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Boots Pharmacy</td>
            <td class="nhsuk-table__cell">North East and North Cumbria ICB</td>
            <td class="nhsuk-table__cell">6FBP3</td>
            <td class="nhsuk-table__cell">sarah.johnson@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="edit-site">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Phillips Pharmacy</td>
            <td class="nhsuk-table__cell">South Yorkshire ICB</td>
            <td class="nhsuk-table__cell">4PLP7</td>
            <td class="nhsuk-table__cell">david.phillips@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Wellcare Chemist</td>
            <td class="nhsuk-table__cell">Humber and North Yorkshire ICB</td>
            <td class="nhsuk-table__cell">3WLC2</td>
            <td class="nhsuk-table__cell">rebecca.smith@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Sutton Pharmacy</td>
            <td class="nhsuk-table__cell">West Yorkshire ICB</td>
            <td class="nhsuk-table__cell">2STP5</td>
            <td class="nhsuk-table__cell">james.sutton@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Healthwise Chemist</td>
            <td class="nhsuk-table__cell">North East and North Cumbria ICB</td>
            <td class="nhsuk-table__cell">7HWC8</td>
            <td class="nhsuk-table__cell">emma.rogers@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Green Cross Pharmacy</td>
            <td class="nhsuk-table__cell">South Yorkshire ICB</td>
            <td class="nhsuk-table__cell">9GCP1</td>
            <td class="nhsuk-table__cell">michael.green@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Superdrug Pharmacy</td>
            <td class="nhsuk-table__cell">West Yorkshire ICB</td>
            <td class="nhsuk-table__cell">8SDP4</td>
            <td class="nhsuk-table__cell">lisa.cooper@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Village Pharmacy</td>
            <td class="nhsuk-table__cell">Humber and North Yorkshire ICB</td>
            <td class="nhsuk-table__cell">1VLP6</td>
            <td class="nhsuk-table__cell">robert.wilson@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Rowlands Pharmacy</td>
            <td class="nhsuk-table__cell">North East and North Cumbria ICB</td>
            <td class="nhsuk-table__cell">6RLP5</td>
            <td class="nhsuk-table__cell">jennifer.rowland@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Morrisons Pharmacy</td>
            <td class="nhsuk-table__cell">West Yorkshire ICB</td>
            <td class="nhsuk-table__cell">3MRP7</td>
            <td class="nhsuk-table__cell">thomas.baker@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Tesco Pharmacy</td>
            <td class="nhsuk-table__cell">South Yorkshire ICB</td>
            <td class="nhsuk-table__cell">4TCP2</td>
            <td class="nhsuk-table__cell">karen.davies@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Asda Pharmacy</td>
            <td class="nhsuk-table__cell">Humber and North Yorkshire ICB</td>
            <td class="nhsuk-table__cell">5ADP9</td>
            <td class="nhsuk-table__cell">paul.thompson@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Day Lewis Pharmacy</td>
            <td class="nhsuk-table__cell">North East and North Cumbria ICB</td>
            <td class="nhsuk-table__cell">2DLP8</td>
            <td class="nhsuk-table__cell">susan.lewis@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Cohens Pharmacy</td>
            <td class="nhsuk-table__cell">West Yorkshire ICB</td>
            <td class="nhsuk-table__cell">7CHP3</td>
            <td class="nhsuk-table__cell">brian.cohen@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Medipharm Chemist</td>
            <td class="nhsuk-table__cell">South Yorkshire ICB</td>
            <td class="nhsuk-table__cell">9MPC4</td>
            <td class="nhsuk-table__cell">olivia.patel@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Cornerstone Pharmacy</td>
            <td class="nhsuk-table__cell">Humber and North Yorkshire ICB</td>
            <td class="nhsuk-table__cell">1CSP6</td>
            <td class="nhsuk-table__cell">richard.stone@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Abbey Pharmacy</td>
            <td class="nhsuk-table__cell">North East and North Cumbria ICB</td>
            <td class="nhsuk-table__cell">3ABP2</td>
            <td class="nhsuk-table__cell">helen.abbey@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Park View Pharmacy</td>
            <td class="nhsuk-table__cell">West Yorkshire ICB</td>
            <td class="nhsuk-table__cell">8PVP7</td>
            <td class="nhsuk-table__cell">mark.parker@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Hillside Pharmacy</td>
            <td class="nhsuk-table__cell">South Yorkshire ICB</td>
            <td class="nhsuk-table__cell">4HSP1</td>
            <td class="nhsuk-table__cell">natalie.hill@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
          <tr class="nhsuk-table__row">
            <td class="nhsuk-table__cell">Sunrise Pharmacy</td>
            <td class="nhsuk-table__cell">Humber and North Yorkshire ICB</td>
            <td class="nhsuk-table__cell">5SRP8</td>
            <td class="nhsuk-table__cell">daniel.morris@nhs.net</td>
            <td class="nhsuk-table__cell"><a href="">Edit</a></td>
          </tr>
        </tbody>
      </table>





    </div>
  </div>
{% endblock %}

{% block pageScripts %}

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    // Get the search input and button elements
    const searchInput = document.getElementById('q');
    const searchButton = searchInput ? searchInput.parentElement.querySelector('button[type="submit"]') : null;
    
    // Exit if we can't find the required elements
    if (!searchInput || !searchButton) return;
    
    // Get all table rows
    const tableRows = Array.from(document.querySelectorAll('.nhsuk-table__body .nhsuk-table__row'));
    if (!tableRows.length) return;
    
    // Get the table caption to update with search results info
    const tableCaption = document.querySelector('.nhsuk-table__caption');
    const originalCaptionText = tableCaption ? tableCaption.textContent : '';
    
    // Get the form element to prevent default submission
    const searchForm = searchInput.closest('form');
    if (searchForm) {
      // Make sure the form doesn't try to submit with POST
      // We'll keep the method as post but prevent the actual submission
      searchForm.addEventListener('submit', function(e) {
        // Prevent the form from submitting and refreshing the page
        e.preventDefault();
        e.stopPropagation();
        
        // Trigger the search filter
        filterTable();
        
        return false;
      });
    }
    
    // Create a no results row
    const noResultsRow = document.createElement('tr');
    noResultsRow.className = 'nhsuk-table__row';
    noResultsRow.style.display = 'none';
    
    const noResultsCell = document.createElement('td');
    noResultsCell.className = 'nhsuk-table__cell';
    noResultsCell.setAttribute('colspan', '5');
    noResultsCell.textContent = 'No sites match your search criteria';
    
    noResultsRow.appendChild(noResultsCell);
    
    // Add the no results row to the table body
    const tableBody = document.querySelector('.nhsuk-table__body');
    if (tableBody) {
      tableBody.appendChild(noResultsRow);
    }
    
    // Function to filter the table rows based on search input
    function filterTable() {
      const searchText = searchInput.value.trim();
      
      // Get just the first 3 letters from the search text (if there are at least 3)
      const searchValue = searchText.length >= 3 ? 
                          searchText.substring(0, 3).toLowerCase() : 
                          searchText.toLowerCase();
      
      // If search is empty, show all rows
      if (searchValue === '') {
        tableRows.forEach(row => row.style.display = '');
        if (tableCaption) tableCaption.textContent = originalCaptionText;
        noResultsRow.style.display = 'none';
        return;
      }
      
      // Only proceed with filtering if we have at least 1 character to match against
      let matchCount = 0;
      
      tableRows.forEach(row => {
        // Get the text content from all cells we want to search
        const name = row.cells[0].textContent.toLowerCase();
        const icb = row.cells[1].textContent.toLowerCase();
        const ods = row.cells[2].textContent.toLowerCase();
        
        // Check if the search value matches the first 3 letters of any field
        const nameMatch = name.startsWith(searchValue);
        const icbMatch = icb.startsWith(searchValue);
        const odsMatch = ods.startsWith(searchValue);
        
        // Show or hide the row based on the match
        const isMatch = nameMatch || icbMatch || odsMatch;
        row.style.display = isMatch ? '' : 'none';
        
        if (isMatch) {
          matchCount++;
        }
      });
      
      // Update the table caption
      if (tableCaption) {
        if (searchValue) {
          const displayText = searchText.length > 3 ? 
                              `"${searchText.substring(0, 3)}" (first 3 letters of "${searchText}")` : 
                              `"${searchText}"`;
          tableCaption.textContent = `Found ${matchCount} site${matchCount !== 1 ? 's' : ''} matching ${displayText}`;
        } else {
          tableCaption.textContent = originalCaptionText;
        }
      }
      
      // Show or hide the no results row
      noResultsRow.style.display = (matchCount === 0) ? '' : 'none';
    }
    
    // Add click event listener to the search button
    searchButton.addEventListener('click', function(e) {
      e.preventDefault();
      filterTable();
    });
    
    // Add a clear button next to the search input
    const searchContainer = searchInput.parentElement;
    if (searchContainer) {
      const clearButton = document.createElement('button');
      clearButton.type = 'button';
      clearButton.className = 'nhsuk-button nhsuk-button--secondary nhsuk-u-margin-left-2 app-button--small nhsuk-u-margin-bottom-0';
      clearButton.textContent = 'Clear';
      clearButton.setAttribute('data-module', 'nhsuk-button');
      
      // Insert clear button after the search button
      searchButton.insertAdjacentElement('afterend', clearButton);
      
      // Clear search when button is clicked
      clearButton.addEventListener('click', function() {
        searchInput.value = '';
        // Reset all table rows to be visible
        tableRows.forEach(row => row.style.display = '');
        // Reset caption
        if (tableCaption) tableCaption.textContent = originalCaptionText;
        // Hide the no results row
        noResultsRow.style.display = 'none';
        
        searchInput.focus();
      });
    }
  });
</script>
{% endblock %}